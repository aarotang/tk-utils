# .github/workflows/photo-scanner.yml
name: Kingdom Story Photo Scanner

on:
  push:
    paths:
      - 'announcements/**/images/**'
      - 'announcements/**/*.jpg'
      - 'announcements/**/*.png'
      - 'announcements/**/*.jpeg'
  workflow_dispatch:

jobs:
  scan-photos:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
        
    - name: Install dependencies
      run: |
        pip install pillow pytesseract opencv-python-headless
        sudo apt-get update
        sudo apt-get install tesseract-ocr tesseract-ocr-chi-tra tesseract-ocr-chi-sim
        
    - name: Scan new photos and update announcements
      run: python scripts/photo_scanner.py
      
    - name: Commit updated announcements
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      run: |
        git config --local user.email "194980684+aarotang@users.noreply.github.com"
        git config --local user.name "aarotang"
        git add announcements/
        if git diff --staged --quiet; then
          echo "No changes to commit"
        else
          git commit -m "ðŸ“¸ Auto-update: Generated announcements from new photos"
          git push
        fi
